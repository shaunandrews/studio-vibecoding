# Preview Bug Fixes — February 17, 2026

## Summary
Fired up the dev server to test seed site rendering. Found and fixed four issues preventing the preview from working correctly.

## Bugs Fixed

### 1. Page slug mismatch — "Preview Error: Page '/' not found"
Both seed sites define homepage slug as `""` (empty string), but SitePreview initializes `currentPage` to `"/"`. The renderer did an exact match, so `"/" !== ""` failed for every page.

**Fix:** Normalize slugs in the renderer — strip leading slashes and treat `"/"` as `""` before matching. Applied to both `renderSite()` and the new `getPageData()`. Also fixed the `pages` computed in SitePreview to map both `""` and `"/"` to `'homepage'`.

### 2. Nav links in iframe didn't navigate
Seed sites use standard `<a href="/menu">` links, but the iframe listener script only caught `data-navPage` attribute clicks.

**Fix:** Added anchor tag interception to the click handler — any `<a>` with an internal href (starts with `/`, not `//`) gets intercepted and sent as a `navigate` postMessage.

### 3. Font flash (FOUT) on every page navigation
Every navigation replaced the entire `srcdoc`, which destroyed the iframe document and forced Google Fonts to re-download/re-parse. Even with HTTP caching, the new browsing context caused a visible flash.

**Fix:** Switched to in-place page swapping via postMessage. The iframe document loads once (via `srcdoc`) and stays alive. Subsequent navigations send a `page-update` message that swaps section styles and body content without reloading the document. Fonts, theme CSS, and the listener script persist.

New exports: `getPageData()` (extracts section data for a page) and `sendPageUpdate()` (sends page-update postMessage to iframe).

### 4. Default body margin on iframe
Browser default `body { margin: 8px }` caused visible gap around the preview content.

**Fix:** Added `body { margin: 0 }` reset to the rendered document's `<head>`.

### 5. Page titles included site name suffix
Seed data had titles like "Menu | Downstreet Cafe" but the renderer already appends `- {site.name}` to the `<title>` tag, causing double naming. The BrowserBar dropdown also showed the full compound title.

**Fix:** Simplified seed data titles to just the page name ("Home", "Menu", "About", "Work").

## Files Changed
- `src/data/site-renderer.ts` — Slug normalization, anchor interception, page-update handler, body margin reset, getPageData/sendPageUpdate exports
- `src/components/features/SitePreview.vue` — postMessage-based navigation, iframe ref, srcdoc only on initial load, slug normalization in pages computed
- `src/data/seed-sites/downstreet-cafe.ts` — Simplified page titles
- `src/data/seed-sites/portfolio.ts` — Simplified page titles
